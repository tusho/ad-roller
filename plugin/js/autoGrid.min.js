/* ======================================================= 
 * Auto Grid Responsive Gallery
 * By David Blanco
 *
 * Contact: http://codecanyon.net/user/davidbo90
 *
 * Created: June 6, 2013
 *
 * Copyright (c) 2013, David Blanco. All rights reserved.
 * Released under CodeCanyon License http://codecanyon.net/
 *
 * Note: Script based in jQuery Masonry v2.1.07 made by David DeSandro http://masonry.desandro.com/ (under MIT)
 *
 * ======================================================= */

(function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,s=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if("object"==typeof e){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if("object"===n)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),function(e){function t(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n=document.documentElement,r=function(){};n.addEventListener?r=function(e,t,n){e.addEventListener(t,n,!1)}:n.attachEvent&&(r=function(e,n,r){e[n+r]=r.handleEvent?function(){var n=t(e);r.handleEvent.call(r,n)}:function(){var n=t(e);r.call(e,n)},e.attachEvent("on"+n,e[n+r])});var i=function(){};n.removeEventListener?i=function(e,t,n){e.removeEventListener(t,n,!1)}:n.detachEvent&&(i=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(r){e[t+n]=void 0}});var s={bind:r,unbind:i};"function"==typeof define&&define.amd?define("eventie/eventie",s):e.eventie=s}(this),function(e,t){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,r){return t(e,n,r)}):"object"==typeof exports?module.exports=t(e,require("eventEmitter"),require("eventie")):e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}(this,function(e,t,n){function r(e,t){for(var n in t)e[n]=t[n];return e}function i(e){return"[object Array]"===h.call(e)}function s(e){var t=[];if(i(e))t=e;else if("number"==typeof e.length)for(var n=0,r=e.length;r>n;n++)t.push(e[n]);else t.push(e);return t}function o(e,t,n){if(!(this instanceof o))return new o(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=s(e),this.options=r({},this.options),"function"==typeof t?n=t:r(this.options,t),n&&this.on("always",n),this.getImages(),f&&(this.jqDeferred=new f.Deferred);var i=this;setTimeout(function(){i.check()})}function u(e){this.img=e}function a(e){this.src=e,p[e]=this}var f=e.jQuery,l=e.console,c=l!==void 0,h=Object.prototype.toString;o.prototype=new t,o.prototype.options={},o.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var n=this.elements[e];"IMG"===n.nodeName&&this.addImage(n);for(var r=n.querySelectorAll("img"),i=0,s=r.length;s>i;i++){var o=r[i];this.addImage(o)}}},o.prototype.addImage=function(e){var t=new u(e);this.images.push(t)},o.prototype.check=function(){function e(e,i){return t.options.debug&&c&&l.log("confirm",e,i),t.progress(e),n++,n===r&&t.complete(),!0}var t=this,n=0,r=this.images.length;if(this.hasAnyBroken=!1,!r)return this.complete(),void 0;for(var i=0;r>i;i++){var s=this.images[i];s.on("confirm",e),s.check()}},o.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})},f&&(f.fn.imagesLoaded=function(e,t){var n=new o(this,e,t);return n.jqDeferred.promise(f(this))}),u.prototype=new t,u.prototype.check=function(){var e=p[this.img.src]||new a(this.img.src);if(e.isConfirmed)return this.confirm(e.isLoaded,"cached was confirmed"),void 0;if(this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var t=this;e.on("confirm",function(e,n){return t.confirm(e.isLoaded,n),!0}),e.check()},u.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)};var p={};return a.prototype=new t,a.prototype.check=function(){if(!this.isChecked){var e=new Image;n.bind(e,"load",this),n.bind(e,"error",this),e.src=this.src,this.isChecked=!0}},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},a.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},a.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},a.prototype.unbindProxyEvents=function(e){n.unbind(e.target,"load",this),n.unbind(e.target,"error",this)},o});(function(e,t,n){"use strict";var r=t.event,i=t.event.handle?"handle":"dispatch",s;r.special.smartresize={setup:function(){t(this).bind("resize",r.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",r.special.smartresize.handler)},handler:function(e,t){var n=this,o=arguments;e.type="smartresize";if(s){clearTimeout(s)}s=setTimeout(function(){r[i].apply(n,o)},t==="execAsap"?0:100)}};t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])};t.Mason=function(e,n){this.element=t(n);this._create(e);this._init()};t.Mason.settings={isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500,complete:function(){var e=t(this);if(!e.hasClass("grid-brick")){if(t.fn.grid.defaults.lazyLoad){t.waypoints("refresh")}if(e.hasClass("grid-with-loading-boxes")){e.removeClass("grid-with-loading-boxes");e.addClass("completeAddingImages")}}}},gutterWidth:0,isRTL:false,isFitWidth:false,containerStyle:{position:"relative"}};t.Mason.prototype={_resized:false,_filterFindBricks:function(e){var t=this.options.itemSelector;return!t?e:e.filter(t).add(e.find(t))},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("grid-brick");return t},_create:function(n){this.options=t.extend(true,{},t.Mason.settings,n);this.styleQueue=[];var r=this.element[0].style;this.originalStyle={height:r.height||""};var i=this.options.containerStyle;for(var s in i){this.originalStyle[s]=r[s]||""}this.element.css(i);this.horizontalDirection=this.options.isRTL?"right":"left";var o=this.element.css("padding-"+this.horizontalDirection);var u=this.element.css("padding-top");this.offset={x:o?parseInt(o,10):0,y:u?parseInt(u,10):0};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth==="function";var a=this;setTimeout(function(){a.element.addClass("grid")},0);if(this.options.isResizable){t(e).bind("smartresize.grid",function(){a.resize()})}this.reloadItems()},_init:function(e){this._getColumns();this._reLayout(e)},option:function(e,n){if(t.isPlainObject(e)){this.options=t.extend(true,this.options,e)}},layout:function(e,t){for(var n=0,r=e.length;n<r;n++){this._placeBrick(e[n])}var i={};i.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var s=0;n=this.cols;while(--n){if(this.colYs[n]!==0){break}s++}i.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:i});var o=!this.isLaidOut?"css":this.options.isAnimated?"animate":"css",u=this.options.animationOptions;var a;var f=false;for(n=0,r=this.styleQueue.length;n<r;n++){a=this.styleQueue[n];o=!this.isLaidOut?"css":this.options.isAnimated?"animate":"css";var l=a.$el.hasClass("loading-box");if(l&&!this.element.hasClass("noSupportTransform")){o="css";f=true}else if(f){a.$el["css"](a.style,u)}a.$el.removeClass("loading-box");var c=a.$el.css("left");var h=a.$el.css("top");var p=a.style.left+"px";var d=a.style.top+"px";if(c==p&&h==d||l==true){a.$el.data("moving",false)}else{a.$el.data("moving",true)}var v=500;a.$el[o](a.style,u)}this.styleQueue=[];if(t){t.call(e)}this.isLaidOut=true},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(true)||t;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var n=t(e),r,i,s,o,u;r=Math.ceil(n.outerWidth(true)/this.columnWidth);r=Math.min(r,this.cols);if(r===1){s=this.colYs}else{i=this.cols+1-r;s=[];for(u=0;u<i;u++){o=this.colYs.slice(u,u+r);s[u]=Math.max.apply(Math,o)}}var a=Math.min.apply(Math,s),f=0;for(var l=0,c=s.length;l<c;l++){if(s[l]===a){f=l;break}}var h={top:a+this.offset.y};h[this.horizontalDirection]=this.columnWidth*f+this.offset.x;this.styleQueue.push({$el:n,style:h});var p=a+n.outerHeight(true),d=this.cols+1-c;for(l=0;l<d;l++){this.colYs[f+l]=p}},resize:function(){var e=this.cols;this._getColumns();if(this.isFluid||this.cols!==e){this._reLayout()}},_reLayout:function(e){var t=this.cols;this.colYs=[];while(t--){this.colYs.push(0)}this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems();this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else{this._appended(e,n)}},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n);this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e);e.remove()},destroy:function(){this.$bricks.removeClass("grid-brick").each(function(){this.style.position="";this.style.top="";this.style.left=""});var n=this.element[0].style;for(var r in this.originalStyle){n[r]=this.originalStyle[r]}this.element.unbind(".grid").removeClass("grid").removeData("grid");t(e).unbind(".grid")}};t.fn.grid=function(r){var i=function(i){var s=t.extend({},t.fn.grid.defaults,r);if(s.visibleCaption){s.caption=false}if(r!=n&&r.lazyLoad!=n){t.fn.grid.defaults.lazyLoad=r.lazyLoad}if(r==n){r={}}r.isFitWidth=s.isFitWidth;r.isAnimated=s.isAnimated;r.itemSelector=".gbox";r.gutterWidth=s.horizontalSpaceBetweenThumbnails;var o=t(i).addClass("centered").addClass("grid-clearfix");var u=s.columnWidth;if(u=="auto"){r.columnWidth=function(e){var t=-999;for(var n=s.columns;n>=1;n--){if(t<s.columnMinWidth){t=(e-(n-1)*r.gutterWidth)/n|0}}o.find("div.gbox").width(t);return t}}else if(typeof u!="function"){r.columnWidth=function(e){var t=u;o.find("div.gbox").width(t);return t}}o.find("div.gbox").css("margin-bottom",s.verticalSpaceBetweenThumbnails);var a=function(){var e=document.createElement("div"),t="Khtml ms O Moz Webkit".split(" "),n=t.length;return function(r){if(r in e.style)return true;r=r.replace(/^[a-z]/,function(e){return e.toUpperCase()});while(n--){if(t[n]+r in e.style){return true}}return false}}();if(!a("transform")){o.addClass("noSupportTransform")}else{o.addClass("visible")}var f=null;var l=o.data("directory");var c=t('<ul class="category-navbar" />').hide().insertBefore(o);var h=function(){var e=c.find("li[class=select]").data("category");return e};var p=t("<div />").insertAfter(o);var d=function(){p.addClass("grid-loader").removeClass("grid-loadMore").html("")};var v=function(){p.removeClass("grid-loader")};var m=false;var g=function(e){var t=0;for(var n in f){var r=f[n];if(e==n||e=="all"){for(var i in r){t++}}}if(t>0){m=false;return true}else{return false}};var y=function(e){if(e){p.addClass("grid-loadMore").html("LOAD MORE IMAGES")}else{p.removeClass("grid-loadMore").html("")}};var b=function(e,t,n){var r="thumbnails/";if(n=="no"){r=""}var i=e+"/";if(e=="all"){i=""}var o=t.split(/\.(?=[^.]*$)/)[0];var u="<h5>In "+e+"</h5>";if(e=="all"||s.captionCategory==false){u=""}var a="";if(o.indexOf("$$")!=-1){var f=o.split("$$");o=f[0];var c=f[1].split(":").join("/");c=c.split("|").join("/");a='data-url="'+c+'"'}if(o.substr(1,1)=="-"){o=o.substr(2)}var h="";var p="";if(s.visibleCaption){h="visible-caption"}var d='<div class="gbox" data-category="'+e+'" '+a+">"+'<img src="'+l+"/"+i+r+t+'" data-lightbox="'+l+"/"+i+t+'" />'+'<div class="image-caption '+h+'">'+"<h3>"+o+"</h3>"+u+"</div>"+'<div class="lightbox-text">'+o+" <span>In "+e+"</span>"+"</div>"+"</div>";return d};var w=function(){var e=h();if(e!="all"){o.children("div").not('.gbox[data-category="'+e+'"]').removeClass("gbox grid-brick").hide()}};var E=function(e){e=t(e).addClass("loading-box");e.css("margin-bottom",s.verticalSpaceBetweenThumbnails);o.append(e.hide());o.imagesLoaded(function(){e.hide();w();o.addClass("grid-with-loading-boxes");o.grid("reload");var t=[];t.push(e);k(t,[]);v();y(g(h()));m=false})};var S=function(e){var t=[];var n=Array();for(var r in e){if(e.hasOwnProperty(r)){t.push(e[r].order.toLowerCase()+"-&$&$-"+r)}}t.sort();if(s.imagesOrder=="byName"||s.imagesOrder=="byDateReverse"){}else{t.reverse()}jQuery.each(t,function(t,r){var i=r.split("-&$&$-");i=i[1];n.push(e[i])});return n};var x=function(e){d();var t=0;for(var n in f){var r=f[n];var i=0;for(var o in r){i++}if(i>t)t=i}var u=new Array;if(s.aleatoryImagesFromCategories){for(var a=0;a<t;a++){var l=0;for(var n in f){r=f[n];var c=n;if(l==0){c="all"}var h=0;for(var o in r){if(h==a){u.push({category:c,image:o,thumb:r[o].thumb,order:r[o].order,categoryOriginal:n});break}h++}l++}}}else{var l=0;for(var n in f){var r=f[n];var c=n;if(l==0){c="all"}for(var o in r){u.push({category:c,image:o,thumb:r[o].thumb,order:r[o].order,categoryOriginal:n})}l++}}if(s.orderInAll&&s.imagesOrder!="random"){u=S(u)}var p="";var v=0;while(v<e){if(v>=u.length)break;var m=u[v];p+=b(m["category"],m["image"],m["thumb"]);delete f[m["categoryOriginal"]][m["image"]];v++}E(p)};var T=function(e,t){d();var n=new Array;var r=0;for(var i in f){var o=f[i];var u=i;if(r==0){u="all"}if(u==t){for(var a in o){n.push({category:u,image:a,thumb:o[a].thumb,order:o[a].order,categoryOriginal:i})}}r++}if(s.orderInAll&&s.imagesOrder!="random"){n=S(n)}var l="";var c=0;while(c<e){if(c>=n.length)break;var h=n[c];l+=b(h["category"],h["image"],h["thumb"]);delete f[h["categoryOriginal"]][h["image"]];c++}E(l)};var N=function(){if(p.hasClass("grid-loadMore")){var e=h();if(e=="all"){x(s.imagesToLoad)}else{T(s.imagesToLoad,e)}}};p.on("click",function(){N()});if(s.lazyLoad){p.waypoint(function(e){var t=o;if(t.hasClass("completeAddingImages")){if(p.hasClass("grid-loadMore")){N();t.removeClass("completeAddingImages")}}},{context:e,continuous:true,enabled:true,horizontal:false,offset:"bottom-in-view",triggerOnce:false})}var C=function(){var e=0;for(var n in f){var r=n;if(r.substr(1,1)=="-"){r=r.substr(2)}var i=t("<li />").data("category",n).appendTo(c);t("<a />").html(r).appendTo(i);if(e==0){i.addClass("select");i.data("category","all")}e++}if(s.smartNavBar&&e<=2){s.showNavBar=false}if(s.showNavBar){c.slideDown(400)}};var k=function(e,n){for(var i=0;i<e.length;i++){e[i].each(function(){var e=t(this).removeClass("noTransform");if(e.hasClass("grid-brick")){if(e.is(":hidden")){if(o.hasClass("noSupportTransform")){e.show()}else{e.show();if(e.data("moving")==false){e.animate(s.hiddenStyle,0);e.animate(s.visibleStyle,400,function(){e.addClass("noTransform")})}else{e.animate(s.visibleStyle,0);e.addClass("noTransform")}}}else{e.animate(s.visibleStyle,r.animOpts,function(){e.addClass("noTransform")})}}})}for(var i=0;i<n.length;i++){n[i].each(function(){var e=t(this).removeClass("noTransform");if(e.is(":hidden")==false){e.addClass("box");if(o.hasClass("noSupportTransform")){e.hide();e.removeClass("box")}else{e.animate(s.visibleStyle,0);e.animate(s.hiddenStyle,r.animOpts,function(){e.hide();e.removeClass("box")})}}else{}})}};t.getJSON("reader.php?directory="+l+"&categoriesOrder="+s.categoriesOrder+"&imagesOrder="+s.imagesOrder,function(e){f=e;if(jQuery.isArray(e["All"])){e["All"]={}}c.css("display","none");C();x(s.imagesToLoadStart)});c.on("click","a",function(e){e.preventDefault();var t=jQuery(this);if(t.parent("li").hasClass("select")){return}o.removeClass("completeAddingImages");o.addClass("grid-with-loading-boxes");t.parent("li").addClass("select").siblings("li").removeClass("select");var r=o;var i=t.parent("li").data("category");var s=[];var u=[];if(i=="all"){var a=r.children("div").addClass("gbox grid-brick");if(o.hasClass("noSupportTransform")){a.css({top:200,left:200})}s.push(a)}else{var f=r.children('div[data-category="'+i+'"]').addClass("gbox grid-brick");if(f[0]!=n){if(o.hasClass("noSupportTransform")){f.css({top:200,left:200})}s.push(f.stop())}var l=r.children("div").not('.gbox[data-category="'+i+'"]').removeClass("gbox grid-brick");u.push(l)}o.grid("reload");k(s,u);y(g(h()))});o.on("mouseenter.hoverdir, mouseleave.hoverdir","div.gbox",function(e){if(!s.caption)return;var r=t(this),i=e.type,o=r.find("div.image-caption"),u=L(r,{x:e.pageX,y:e.pageY}),a=A(u,r);var f=o.children("div.aligment");if(f[0]==n){var l=o.html();o.html("<div class='aligment'><div class='aligment'>"+l+"</div></div>")}if(i==="mouseenter"){if(s.captionType=="classic"){o.css({left:0,top:0});o.fadeIn(300);return}o.css({left:a.from,top:a.to});o.stop().show().fadeTo(0,1,function(){t(this).stop().animate({top:0,left:0},200,"linear")})}else{if(s.captionType=="classic"){o.css({left:0,top:0});o.fadeOut(300);return}if(s.captionType=="grid-fade"){o.fadeOut(700)}else{o.stop().animate({left:a.from,top:a.to},200,"linear",function(){o.hide()})}}});var L=function(e,t){var n=e.width(),r=e.height(),i=(t.x-e.offset().left-n/2)*(n>r?r/n:1),s=(t.y-e.offset().top-r/2)*(r>n?n/r:1),o=Math.round((Math.atan2(s,i)*(180/Math.PI)+180)/90+3)%4;return o};var A=function(e,t){var n,r;switch(e){case 0:if(!s.reverse){n=0,r=-t.height()}else{n=0,r=-t.height()}break;case 1:if(!s.reverse){n=t.width(),r=0}else{n=-t.width(),r=0}break;case 2:if(!s.reverse){n=0,r=t.height()}else{n=0,r=-t.height()}break;case 3:if(!s.reverse){n=-t.width(),r=0}else{n=t.width(),r=0}break}return{from:n,to:r}};var O=t("body");var M={interval:"none"};var _=0;var D=t('<div class="autoGrid-lightbox" />').appendTo(O);var P=t('<div class="autoGrid-nav" />').appendTo(D);var H=t('<div class="autoGrid-close" />').appendTo(P);var B=t('<i class="iconClose" />').appendTo(H);var j=t('<div class="autoGrid-play" />');if(s.lightboxPlayBtn){j.appendTo(P)}var F=t('<i class="iconPlay" />').appendTo(j);var I=t('<div class="autoGrid-lbcaption" />').appendTo(P).html("Here will go the text for the lightbox");var q=t('<div class="autoGrid-next" />').appendTo(P);var R=t('<i class="iconNext" />').appendTo(q);var U=t('<div class="autoGrid-prev" />').appendTo(P);var z=t('<i class="iconPrev" />').appendTo(U);var W=t('<div class="lightbox-timer" />').appendTo(D);var X=H.width();var V=3;if(s.lightboxPlayBtn)V=4;var J=function(){var e=D.outerWidth(false);if(e<650){I.hide();q.css("width",e/V);U.css("width",e/V);j.css("width",e/V);H.css("width",e-e/V*(V-1))}else{I.show();q.css("width",X);U.css("width",X);j.css("width",X);H.css("width",X)}var t=D.find("img");var n=D.outerHeight(false)-P.outerHeight(false);t.css("max-height",n);var r=D.find("iframe");var n=D.outerHeight(false)-P.outerHeight(false);if(n!=0){r.css("max-height",n)}else{r.css("max-height","none")}};jQuery(e).resize(function(){J()});var K=new Image;var Q=function(){if(K!=null){K.onload=null;K=null}D.find(".lightbox-alignment").remove();D.find(".lightbox-alignment2").remove();D.find("img").remove()};var G=function(){D.find("iframe").remove()};var Y=function(){D.find(".lb-loader").remove()};var Z=function(){D.append('<div class="lb-loader"/>')};D.attr("unselectable","on").css("user-select","none").on("selectstart",false);var et=function(){W.stop(true,true).width(0)};var tt=function(){clearInterval(M.interval)};var nt=function(){if(s.lightBoxShowTimer==false)return;W.css({position:"absolute",bottom:0}).animate({width:"100%"},s.lightBoxPlayInterval,"linear",function(){et()})};var rt=false;var it=false;var st=function(){M.interval=setTimeout(function(){pt()},s.lightBoxPlayInterval);nt()};var ot=function(){if(rt&&it==false){et();tt();st()}};var ut=function(e){var n=t('<iframe src="'+e+'" class="lightbox-iframe" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>');D.append(n.hide());var r=n[0];if(r.attachEvent){r.attachEvent("onload",function(){Y();n.fadeIn(s.lightBoxSpeedFx,function(){ot()});J();K=new Image})}else{r.onload=function(){Y();n.fadeIn(s.lightBoxSpeedFx,function(){ot()});J();K=new Image}}};var at=t("<span />");var ft=function(e,r){G();Q();Y();Z();var i=0;var o=0;if(r!=true){i=.9;o=s.lightBoxSpeedFx}if(s.lightBoxZoomAnim==false){i=1}var u=e;var a=u.data("lightbox");if(a==n){a=u.attr("src")}var f=u.siblings("div.lightbox-text").html();if(s.lightBoxText==false){f=""}var c="<div><div>"+f+"</div></div>";I.html(c);var h="";for(var p in s.videos){if(a==l+"/"+p){h=s.videos[p];break}}if(h!=""){ut(h);return}K=new Image;var d=t(K);var v=K;K.onload=function(){if(v!=K)return;Y();var e=t('<div class="lightbox-alignment"></div>').appendTo(D);var n=t('<div class="lightbox-alignment2"></div>').appendTo(e);n.append(d.css("margin-top",-P.outerHeight(false)).hide().scale(i));d.fadeIn(o).animate({scale:"1"},{duration:s.lightBoxSpeedFx,complete:function(){ot()}});J()};K.src=a;at.stop(true);at=t(K)};var lt=false;var ct="";o.on("click","div.gbox",function(){lt=true;var r=t(this);var i=r.data("url");ct="";if(i!=n&&s.linkOnLightbox==true){ct="http://"+i}else if(i!=n){e.location.href="http://"+i;return}if(s.lightBox==false){return}it=false;_=o.find(".gbox").index(this);var u=r.children("img");P.animate({"margin-top":0},s.lightBoxSpeedFx);D.fadeIn(s.lightBoxSpeedFx);ft(u,true)});D.on("click","div",function(e){e.stopPropagation()});D.on("click","img",function(e){e.stopPropagation()});D.on("click",".lightbox-alignment",function(){ht()});D.on("click",".lightbox-alignment2",function(){ht()});D.on("click",function(){ht()});H.on("click",function(){ht()});var ht=function(){G();if(s.lightBoxStopPlayOnClose){j.removeClass("selected");rt=false}lt=false;it=true;et();tt();D.find(".lb-loader").remove();var e=0;if(s.lightBoxZoomAnim==false){e=1}var t=D.find("img").stop().show();P.animate({"margin-top":-P.outerHeight(false)},s.lightBoxSpeedFx);if(t[0]!=n){t.animate({scale:e},s.lightBoxSpeedFx,function(){D.fadeOut(100)})}else{D.fadeOut(100)}};var pt=function(){it=false;var e=o.find(".gbox");_+=1;if(_>=e.length){_=0}if(!e.eq(_).is(":visible")){var t=_;for(var r=0;r<e.length;r++){t++;if(t>=e.length){t=0}if(e.eq(t).is(":visible")){_=t;break}}}var i=e.eq(_).children("img");var u=e.eq(_).data("url");ct="";if(u!=n&&s.linkOnLightbox==true){ct="http://"+u}ft(i)};var dt=function(){it=false;var e=o.find(".gbox");_-=1;if(_<0){_=e.length-1}if(!e.eq(_).is(":visible")){var t=_;for(var r=0;r<e.length;r++){t--;if(t<0){t=e.length-1}if(e.eq(t).is(":visible")){_=t;break}}}var i=e.eq(_).children("img");var u=e.eq(_).data("url");ct="";if(u!=n&&s.linkOnLightbox==true){ct="http://"+u}ft(i)};q.on("click",function(){et();tt();pt()});D.on("click","img",function(){if(ct==""){et();tt();pt()}else{location.href=ct}});U.on("click",function(){et();tt();dt()});t(document).keyup(function(e){if(!s.lightboxKeyboardNav)return;if(e.keyCode=="37"){if(lt==false)return;et();tt();dt()}if(e.keyCode=="39"){if(lt==false)return;et();tt();pt()}if(e.keyCode==27){ht()}});if(s.lightBoxAutoPlay){j.addClass("selected");rt=true}j.on("click",function(){i=t(this);if(i.hasClass("selected")){i.removeClass("selected");rt=false;et();tt()}else{i.addClass("selected");rt=true;st()}})};if(typeof r==="string"){var s=Array.prototype.slice.call(arguments,1);this.each(function(){var e=t.data(this,"grid");if(!e){logError("cannot call methods on grid prior to initialization; "+"attempted to call method '"+r+"'");return}if(!t.isFunction(e[r])||r.charAt(0)==="_"){logError("no such method '"+r+"' for grid instance");return}e[r].apply(e,s)})}else{this.each(function(){var e=t.data(this,"grid");if(e){e.option(r||{});e._init()}else{i(this);t.data(this,"grid",new t.Mason(r,this))}})}return this};t.fn.grid.defaults={categoriesOrder:"byName",imagesOrder:"byDate",orderInAll:false,isFitWidth:true,lazyLoad:true,showNavBar:true,smartNavBar:true,imagesToLoadStart:15,imagesToLoad:5,aleatoryImagesFromCategories:true,horizontalSpaceBetweenThumbnails:5,verticalSpaceBetweenThumbnails:5,columnWidth:"auto",columns:5,columnMinWidth:220,isAnimated:true,caption:true,captionCategory:true,captionType:"grid",lightBox:true,lightboxKeyboardNav:true,lightBoxSpeedFx:500,lightBoxZoomAnim:true,lightBoxText:true,lightboxPlayBtn:true,lightBoxAutoPlay:false,lightBoxPlayInterval:4e3,lightBoxShowTimer:true,lightBoxStopPlayOnClose:false,videos:{},linkOnLightbox:false,hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},visibleCaption:false}})(window,jQuery)
